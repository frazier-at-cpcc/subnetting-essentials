<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Subnetting Exercise - Step by Step</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/tailwindcss/2.2.19/tailwind.min.js"></script>
</head>
<body class="bg-gray-100 p-8">
    <div class="max-w-2xl mx-auto bg-white p-6 rounded-lg shadow-md">
        <h1 class="text-2xl font-bold mb-4">Custom Subnet Masks Exercise</h1>
        <div id="problem" class="mb-6">
            <h2 class="text-xl font-semibold mb-2">Problem</h2>
            <p>Number of needed subnets: <span id="neededSubnets" class="font-bold"></span></p>
            <p>Number of needed usable hosts: <span id="neededHosts" class="font-bold"></span></p>
            <p>Network Address: <span id="networkAddress" class="font-bold"></span></p>
        </div>
        <div id="questionContainer" class="mb-6">
            <h3 id="questionText" class="text-lg font-semibold mb-2"></h3>
            <input type="text" id="answerInput" class="w-full px-3 py-2 border rounded mb-2">
            <button id="submitAnswer" class="w-full bg-blue-500 text-white py-2 px-4 rounded hover:bg-blue-600">
                Submit Answer
            </button>
        </div>
        <div id="feedback" class="mt-4 p-4 rounded hidden"></div>
        <button id="newProblem" class="w-full bg-green-500 text-white py-2 px-4 rounded hover:bg-green-600 mt-4 hidden">
            Generate New Problem
        </button>
    </div>

    <script>
        const questions = [
            { id: 'addressClass', text: 'What is the address class?', validate: (answer, correct) => answer.toUpperCase() === correct },
            { id: 'defaultSubnetMask', text: 'What is the default subnet mask?', validate: (answer, correct) => answer === correct },
            { id: 'customSubnetMask', text: 'What is the custom subnet mask?', validate: (answer, correct) => answer === correct },
            { id: 'totalSubnets', text: 'What is the total number of subnets?', validate: (answer, correct) => parseInt(answer) === correct },
            { id: 'totalHostAddresses', text: 'What is the total number of host addresses?', validate: (answer, correct) => parseInt(answer) === correct },
            { id: 'usableAddresses', text: 'What is the number of usable addresses?', validate: (answer, correct) => parseInt(answer) === correct },
            { id: 'borrowedBits', text: 'How many bits were borrowed?', validate: (answer, correct) => parseInt(answer) === correct }
        ];

        let currentQuestionIndex = 0;
        let problem, correctAnswers;

        function generateRandomIP() {
            return `${Math.floor(Math.random() * 256)}.${Math.floor(Math.random() * 256)}.${Math.floor(Math.random() * 256)}.0`;
        }

        function generateProblem() {
            const neededSubnets = Math.floor(Math.random() * 30) + 2;
            const neededHosts = Math.floor(Math.random() * 30) + 2;
            const networkAddress = generateRandomIP();

            document.getElementById('neededSubnets').textContent = neededSubnets;
            document.getElementById('neededHosts').textContent = neededHosts;
            document.getElementById('networkAddress').textContent = networkAddress;

            return { neededSubnets, neededHosts, networkAddress };
        }

        function calculateCorrectAnswers(problem) {
            const { neededSubnets, neededHosts, networkAddress } = problem;
            const firstOctet = parseInt(networkAddress.split('.')[0]);
            let addressClass, defaultSubnetMask, borrowedBits, customSubnetMask;

            if (firstOctet < 128) {
                addressClass = 'A';
                defaultSubnetMask = '255.0.0.0';
            } else if (firstOctet < 192) {
                addressClass = 'B';
                defaultSubnetMask = '255.255.0.0';
            } else {
                addressClass = 'C';
                defaultSubnetMask = '255.255.255.0';
            }

            borrowedBits = Math.ceil(Math.log2(Math.max(neededSubnets, neededHosts + 2)));
            const subnetMaskValue = 256 - Math.pow(2, 8 - borrowedBits);
            customSubnetMask = `${defaultSubnetMask.slice(0, -1)}${subnetMaskValue}`;

            const totalSubnets = Math.pow(2, borrowedBits);
            const totalHostAddresses = Math.pow(2, 8 - borrowedBits);
            const usableAddresses = totalHostAddresses - 2;

            return {
                addressClass,
                defaultSubnetMask,
                customSubnetMask,
                totalSubnets,
                totalHostAddresses,
                usableAddresses,
                borrowedBits
            };
        }

        function displayQuestion() {
            const question = questions[currentQuestionIndex];
            document.getElementById('questionText').textContent = question.text;
            document.getElementById('answerInput').value = '';
            document.getElementById('feedback').classList.add('hidden');
        }

        function checkAnswer() {
            const question = questions[currentQuestionIndex];
            const userAnswer = document.getElementById('answerInput').value;
            const correctAnswer = correctAnswers[question.id];
            const isCorrect = question.validate(userAnswer, correctAnswer);

            const feedback = document.getElementById('feedback');
            feedback.classList.remove('hidden');

            if (isCorrect) {
                feedback.textContent = 'Correct! Moving to the next question.';
                feedback.classList.remove('bg-red-100', 'text-red-700');
                feedback.classList.add('bg-green-100', 'text-green-700');
                currentQuestionIndex++;

                if (currentQuestionIndex < questions.length) {
                    setTimeout(displayQuestion, 1500);
                } else {
                    document.getElementById('questionContainer').classList.add('hidden');
                    feedback.textContent = 'Congratulations! You have completed the exercise.';
                    document.getElementById('newProblem').classList.remove('hidden');
                }
            } else {
                feedback.textContent = `Incorrect. Please try again.`;
                feedback.classList.remove('bg-green-100', 'text-green-700');
                feedback.classList.add('bg-red-100', 'text-red-700');
            }
        }

        function startNewProblem() {
            currentQuestionIndex = 0;
            problem = generateProblem();
            correctAnswers = calculateCorrectAnswers(problem);
            document.getElementById('questionContainer').classList.remove('hidden');
            document.getElementById('newProblem').classList.add('hidden');
            displayQuestion();
        }

        document.getElementById('submitAnswer').addEventListener('click', checkAnswer);
        document.getElementById('newProblem').addEventListener('click', startNewProblem);

        // Start the first problem
        startNewProblem();
    </script>
</body>
</html>